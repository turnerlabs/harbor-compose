general:
  branches:
    only:
      - master
      - develop
      - circleci
deployment:
  release:
    branch: master
    commands:
      - go get github.com/mitchellh/gox
      - go get github.com/tcnksm/ghr
      - go get github.com/inconshreveable/mousetrap
      - BUILD_DATE=$(date -u '+%Y/%m/%d %H:%M:%S')
      - BUILD_VERSION=$(git describe --tags)
      - 'gox -ldflags "-X main.version=$BUILD_VERSION -X main.BuildDate=$BUILD_DATE" -output "dist/ncd_{{.OS}}_{{.Arch}}"'
      - 'ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME --replace `git describe --tags` dist/'
  prerelease:
    branch: [develop, circleci]
    commands:
      - go get github.com/mitchellh/gox
      - go get github.com/tcnksm/ghr
      - go get github.com/inconshreveable/mousetrap
      - 'chmod +x ./build.sh && ./build.sh'
      - 'ghr --prerelease -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME --replace `git describe --tags` dist/'